<html>
  <head>
    <meta charset="utf-8">
    <title>Quest Thumbstick Movement</title>

    <!-- A-Frame core -->
    <script src="https://aframe.io/releases/1.7.1/aframe.min.js"></script>

    <!-- Custom component for thumbstick movement -->
    <script>
      AFRAME.registerComponent('thumbstick-move', {
        schema: {
          speed: {type: 'number', default: 3}  // movement units per second
        },

        init: function () {
          this.direction = new THREE.Vector2(0, 0);
          this.rig = document.querySelector('#rig');
          this.head = document.querySelector('#head');

          // Listen to thumbstick events from this controller
          this.el.addEventListener('thumbstickmoved', (evt) => {
            const x = evt.detail.x; // left/right
            const y = evt.detail.y; // forward/back

            // Small deadzone so it stops cleanly
            if (Math.abs(x) < 0.1 && Math.abs(y) < 0.1) {
              this.direction.set(0, 0);
            } else {
              this.direction.set(x, y);
            }
          });
        },

        tick: function (time, delta) {
          if (!this.rig || !this.head) return;
          if (this.direction.lengthSq() === 0) return;

          const dt = delta / 1000;
          const speed = this.data.speed;

          // Get forward direction from head (camera)
          const headObj = this.head.object3D;
          const forward = new THREE.Vector3(0, 0, -1);
          forward.applyQuaternion(headObj.quaternion);
          forward.y = 0;          // flatten to ground
          forward.normalize();

          const right = new THREE.Vector3().crossVectors(
            forward,
            new THREE.Vector3(0, 1, 0)
          ).normalize();

          const move = new THREE.Vector3();

          // Thumbstick: x = left/right, y = forward/back (note: y is inverted)
          move.addScaledVector(forward, -this.direction.y * speed * dt);
          move.addScaledVector(right, this.direction.x * speed * dt);

          this.rig.object3D.position.add(move);
        }
      });
    </script>
  </head>

  <body>
    <a-scene renderer="colorManagement: true; physicallyCorrectLights: true">
      <a-assets>
        <a-asset-item id="treeModel" src="Assests/tree.glb"></a-asset-item>
        <a-asset-item id="houseModel" src="Assests/asian_big_house.glb"></a-asset-item>
      </a-assets>

      <!-- Models -->
      <a-entity gltf-model="#treeModel"
                position="-10 -5 -40"
                rotation="0 0 0"
                scale="0.7 1 0.7">
      </a-entity>

      <a-entity gltf-model="#houseModel"
                position="10 -6 -60"
                rotation="0 0 0"
                scale="3 3 3">
      </a-entity>

      <!-- Ground -->
      <a-plane src="Assests/ground.jpg"
               position="0 -5 -53"
               rotation="-90 0 0"
               width="150"
               height="100"
               material="repeat: 10 15">
      </a-plane>

      <!-- Sky -->
      <a-sky src="Assests/cloud-blue-sky-background.jpg"
             material="repeat: 0.52 0.68"
             geometry="radius: 500">
      </a-sky>

      <!-- â­ CAMERA RIG  -->
      <a-entity id="rig" position="9.5 0 -32.6">
        <!-- Head / camera -->
        <a-entity id="head"
                  camera
                  look-controls
                  position="0 1.6 0">
        </a-entity>

        <!-- Left hand controller -->
        <a-entity id="leftHand"
                  oculus-touch-controls="hand: left">
        </a-entity>

        <!-- Right hand controller (moves the rig with thumbstick) -->
        <a-entity id="rightHand"
                  oculus-touch-controls="hand: right"
                  thumbstick-move="speed: 3">
        </a-entity>
      </a-entity>
    </a-scene>
  </body>
</html>
